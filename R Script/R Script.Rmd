---
title: "R Script"
author: "Priyanka Choudhary <br /> Mike Rouw <br /> Pratheeba Nalligounder Palanisami"
date: "November 07, 2019"
output:
  html_document: 
    theme: cosmo
    toc: yes
    github_document:
      toc: yes
    word_document: default
    pdf_document:
      toc:yes
---
* * *

# Embed Code
## Set Directory

Note: Root directory path needs to be updated to your local

```{r setup, echo=FALSE, message=FALSE, warning=FALSE} 
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/Priya/Desktop/D2D_4thNov/PartsPerMillion/R Script") 
```

## Load data

```{r loadData}
data <- read.csv("site_phenometrics_data - Updated.csv")
```

# Data cleaning steps

The following columns are renamed directly in the csv file and the updated csv file is used for further cleaning.

Site_ID - SiteID
Site_Name - SiteName
Species_ID - SpeciesID
Common_Name - SpeciesDesc
Phenophase_ID - PhenophaseID
Phenophase_Category - PhenophaseCategory
Phenophase_Description - PhenophaseDesc
Mean_NumDays_Until_Next_No - NumFirstNo
Mean_NumDays_Since_Prior_No - NumLastNo

If the data contains a “first yes” but no “last yes” information, then set the “last yes” information to the same values as the “first yes” information, and set the lag days to “no” at zero.  

# FirstYes

```{r FirstYes}
for(i in 1:nrow(data)){
  if(data$First_Yes_Sample_Size[i] == 0 & data$Last_Yes_Sample_Size[i] > 0) {
    data$First_Yes_Sample_Size[i] <- data$Last_Yes_Sample_Size[i]
    data$First_Yes_Year[i] <- data$Last_Yes_Year[i]
    data$FirstYes[i] <- data$LastYes[i]
    data$NumLastNo[i] <- 0
  }
}
```
The same is true if the data contains a “last yes” but no “first yes”.  Effectively, we are saying that if only one “yes” exists, it is both first and last, and the number of days to “no” is zero.

# FirstNo
```{r FirstNo}
for(i in 1:nrow(data)){
  if(data$Last_Yes_Sample_Size[i] == 0 & data$First_Yes_Sample_Size[i] > 0) {
    data$Last_Yes_Sample_Size[i] <- data$First_Yes_Sample_Size[i]
    data$Last_Yes_Year[i] <- data$First_Yes_Year[i]
    data$LastYes[i] <- data$FirstYes[i]
    data$NumFirstNo[i] <- 0
  }
}
```
We could also move the Julian date and all the statistical columns associated with “first yes” and “last yes”, however in the next pass we will be de-selecting all those columns anyway.

We should now have a dataset with complete information on each observation for “first yes” and “last yes” – anything remaining had NO “yes” observations and will be eliminated in the next pass (based on my Excel look, there are no records to be fully eliminated, but we will put the step in our R script anyway).

**Select rows and columns**

Select rows only with complete data, and we can select columns based on data we will likely be using in the project.  For rows, we require an observation of at least one “yes”.  For columns, we will be eliminating some data that is descriptive but not necessary, columns that have unchanging data, all the “statistical” columns related to sample sizes and Julian dates, and all the observational “conflict” data.  We have elected not to consider the statistical elements (e.g. min, max, std-dev, etc) as all observations are a sample sizes are either 1 or 2.  For samples sizes of 2, the data already contains the mean, so that is the only value we will be using, as the distribution for a sample size of 2 is pretty meaningless.

The columns is replaced to get it convenient for reading
```{r rename column}
 library(dplyr)
 data <- data %>% rename(Year = First_Yes_Year)
```

```{r selectrow}
cols <- c('SiteID', 'SiteName', 'Latitude', 'Longitude', 'SpeciesID', 
          'SpeciesDesc', 'Kingdom', 'SpeciesType', 'PhenophaseID', 'PhenophaseCategory', 'PhenophaseDesc',
          'Year', 'FirstYes', 'LastYes', 'NumLastNo', 'NumFirstNo')
data <- data[cols]
```
We will be adding the DOY for “last no” and “first no” to the dataset. This will add 2 columns to the data.

# LastNo and FirstNo

```{r selectcol}
data['LastNo'] <- data$FirstYes - data$NumLastNo
data['FirstNo'] <- data$LastYes + data$NumFirstNo
```  

The temporal integrity of the following dates was checked, and any rows that did not follow this rule were de-selected.

```{r deselect rows}
   data <- data %>% filter(data$LastNo <= data$FirstYes &
          data$FirstYes <= data$LastYes &
          data$LastYes <= data$FirstNo)
```

# Total Days

```{r create col}
data['TotDays'] <- (data$FirstNo - data$LastNo)+1
```


# Average Days

```{r create AveDays}
for(i in 1:nrow(data)){
data$aveDays[i] <- ceiling((median(data$LastYes[i]:data$FirstNo[i])-median(data$LastNo[i]:data$FirstYes[i]))+1)}
```

# Yes Days

```{r create YesDays}
data['YesDays'] <- (data$LastYes - data$FirstYes)+1
```

# Yes Duration Group

```{r create YesDurationGroup}
data['YesDurationGroup'] <- NA

for(i in 1:nrow(data)){
if(data$YesDays[i] <= 1){
data$YesDurationGroup[i] <- "A. One Day"
} else if (data$YesDays[i] <= 20){
data$YesDurationGroup[i] <- "B. 2-20 Days"
} else if (data$YesDays[i] <= 50){
data$YesDurationGroup[i] <- "C. 21-50 Days"
} else if (data$YesDays[i] <= 100){
data$YesDurationGroup[i] <- "D. 51-100 Days"
} else if (data$YesDays[i] <= 200){
data$YesDurationGroup[i] <- "E. 101-200 Days"
} else {
data$YesDurationGroup[i] <- "F. 201+ Days"
}
}
```

# Descriptive Statistics  

```{r descstats1}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Breaking leaf buds")%>%select(FirstYes))

```

Descrptive statistics with Mean, Median, Min, Max, Range, Sum, Standard mean, variance, Standard deviation, Coefficient variance for species type - decidous broadleaf and phenophaseDesc - breaking leaf buds. 

```{r descstats2}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Breaking leaf buds")%>%select(TotDays))

```

```{r descstats3}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Breaking leaf buds")%>%select(YesDays))

```

```{r descstats4}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Falling leaves")%>%select(FirstYes))

```

```{r descstats5}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Falling leaves")%>%select(TotDays))

```


```{r descstats6}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Falling leaves")%>%select(YesDays))

```

```{r descstats7}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Colored leaves")%>%select(FirstYes))

```


```{r descstats8}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Colored leaves")%>%select(TotDays))

```

```{r descstats9}
library(pastecs)
library(dplyr)
stat.desc(data %>% filter(SpeciesType == "Deciduous broadleaf" & PhenophaseDesc == "Colored leaves")%>%select(YesDays))

```

The final data set is written back into the csv file

# Final Dataset

```{r finaldataset}
write.csv(data, file = "JeanFinalDataSet.csv",row.names=FALSE)
```
This should yield a dataset with `r nrow(data)` rows and `r ncol(data)` columns in the data set. In the next pass, we will enrich the data with some date calculations.



**_Contributorship Statement_** : Priyanka Choudhary, Mike Rouw, Pratheeba Nalligounder Palanisami contributed to the descriptive statistics and R script undertaking and the writing of this document.


